(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{6216:function(e,t,s){Promise.resolve().then(s.bind(s,2772))},2772:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var a=s(9268),n=s(6006),l=function(e){let{message:t,date:s}=e;return(0,a.jsx)("div",{className:"chat chat-end",children:(0,a.jsxs)("div",{className:"chat-bubble bg-[#aad8a1] text-black",children:[t,(0,a.jsx)("div",{className:"chat-footer opacity-50  text-black text-xs",children:"".concat(s.substring(0,10)," ").concat(s.substring(11,16))})]})})},c=function(e){let{message:t,date:s}=e;return(0,a.jsx)("div",{className:"chat chat-start",children:(0,a.jsxs)("div",{className:"chat-bubble  bg-gray-100 text-black",children:[t," ",(0,a.jsx)("div",{className:"chat-footer opacity-50 text-black text-xs",children:"".concat(s.substring(0,10)," ").concat(s.substring(11,16))})]})})},i=s(6323);let r=(0,i.io)("http://localhost:3002",{withCredentials:!0});var o=s(474);function d(e){let{id:t}=e,[s,i]=(0,n.useState)([]),[d,u]=(0,n.useState)(""),[f,m]=(0,n.useState)(""),x=(0,n.useRef)(null),h=()=>{var e;null===(e=x.current)||void 0===e||e.scrollIntoView({behavior:"instant"})};(0,n.useEffect)(()=>{h()},[s]),(0,n.useEffect)(()=>{let e=async()=>{let e=await fetch("".concat("http://localhost:3002","/api/chat/getMessages/").concat(t),{credentials:"include",method:"GET",cache:"default"}),s=await e.json();i(s.messages)};e().catch(e=>o.Am.error("Fail at fetch messages"))},[t]),(0,n.useEffect)(()=>{r.on(t,e=>{i(t=>[...t,{...e,sender:!1}])})},[t]);let v=async e=>{try{u(e);let s=await fetch("".concat("http://localhost:3002","/api/chat/createMessage"),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:t,messageBody:e})}),a=await s.json();g(a)}catch(e){o.Am.error("Fail at send message")}},g=e=>{i(t=>[...t,{...e,sender:!0}])};return(0,a.jsxs)("section",{className:'w-full grow  flex-1 p-8 flex flex-col bg-[url("https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg")] justify-end text-neutral-900 ',children:[(0,a.jsxs)("div",{className:"max-h-[40rem] overflow-auto overflow-x-hidden mb-8  w-full",children:[s&&s.map(e=>e.sender?(0,a.jsx)(l,{message:e.body,date:e.createdAt},e.id):(0,a.jsx)(c,{message:e.body,date:e.createdAt},e.id)),(0,a.jsx)("div",{ref:x})]}),(0,a.jsx)("div",{className:"divider"}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-4 items-center sm:flex-row justify-center  gap-x-8 p-8 bg-slate-300  border-",children:[(0,a.jsx)("input",{onChange:e=>{m(e.currentTarget.value)},value:f,type:"text",placeholder:"Type here",className:"input input-bordered input-sm w-full max-w-md"}),(0,a.jsx)("button",{onClick:()=>{v(f),m("")},className:"btn btn-xs sm:btn-md btn-primary",children:"Send message"})]})]})}function u(e){var t;let{id:s,onSelect:l}=e,[c,i]=(0,n.useState)(),[d,u]=(0,n.useState)(""),[f,m]=(0,n.useState)(!1),[x,h]=(0,n.useState)(0);return(0,n.useEffect)(()=>{let e=async()=>{let e=await fetch("".concat("http://localhost:3002","/api/chat/getInfoOfConversation/").concat(s),{credentials:"include",method:"GET",cache:"default"}),t=await e.json();i(t)};e().catch(e=>{o.Am.error("Error at fetching conversation information")})},[s]),(0,n.useEffect)(()=>{let e=e=>{(null==c?void 0:c.friendId)===e.senderId&&localStorage.getItem("conversationOpen")!==s&&(m(!0),h(e=>e+1)),u(e.body)},t=e=>{if(c){let t={...c,online:e};i(t)}};return r.on("".concat(s,"-badge"),e),r.on(String(null==c?void 0:c.friendId),t),()=>{r.off("".concat(s,"-badge"),e),r.off(String(null==c?void 0:c.friendId),t)}},[s,c]),(0,a.jsx)("div",{className:"w-full rounded-lg",children:(0,a.jsxs)("button",{onClick:()=>{l(s),m(!1),h(0),localStorage.removeItem("conversationOpen"),localStorage.setItem("conversationOpen",s)},className:"flex w-full px-3 justify-evenly items-center  h-12 ",children:[(0,a.jsx)("div",{children:(null==c?void 0:c.avatarUrl)||(0,a.jsx)("div",{className:(null==c?void 0:c.online)?"avatar online":"avatar offline",children:(0,a.jsx)("div",{className:"h-8 rounded-full ring  ring-offset-base-100 ".concat((null==c?void 0:c.online)?"ring-success":"","  ring-offset-2"),children:(0,a.jsx)("img",{src:"https://static-00.iconduck.com/assets.00/avatar-default-symbolic-icon-2048x1949-pq9uiebg.png",alt:"default avatar"})})})}),(0,a.jsxs)("div",{className:"max-w-sm text-center flex flex-col  ",children:[(0,a.jsxs)("span",{className:"text-sm font-bold",children:[" ",c&&c.name]}),(0,a.jsx)("span",{className:"text-xs truncate  w-20",children:d||c&&(null==c?void 0:null===(t=c.lastMessage)||void 0===t?void 0:t.body)})]}),(0,a.jsx)("div",{children:f&&(0,a.jsxs)("div",{className:"badge badge-success badge-xs p-2",children:["+",x]})})]})})}var f=function(e){let{addConversation:t}=e,[s,l]=(0,n.useState)(""),c=async e=>{try{let s=await fetch("".concat("http://localhost:3002","/api/chat/createConversation"),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toEmail:e,messageBody:""})});s.ok||o.Am.error("Error at create conversation");let a=await s.json();t(a)}catch(e){o.Am.error("Error at create conversation")}};return(0,a.jsxs)("div",{className:"flex  flex-col  w-fit mt-8 gap-5",children:[(0,a.jsx)("input",{onChange:e=>{l(e.currentTarget.value)},className:"w-full  ring  ring-offset-base-100 ring-offset-2 rounded-md p-2",placeholder:"Type friend email"}),(0,a.jsx)("button",{className:"btn btn-sm btn-info",onClick:e=>{e.preventDefault(),c(s)},children:"Create"})]})};function m(e){let{Conversations:t,onSelect:s,addConversation:l}=e;return(0,a.jsxs)("aside",{className:"hidden lg:flex lg:flex-col items-center   w-1/6  text-black",children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(f,{addConversation:l})}),(0,a.jsx)("div",{className:"divider"}),t&&t.map(e=>(0,a.jsxs)(n.Fragment,{children:[(0,a.jsx)(u,{onSelect:s,id:String(e.id)}),(0,a.jsx)("div",{className:"divider"})," "]},String(e.id)))]})}function x(e){let{Conversations:t,onSelect:s,addConversation:n}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("dialog",{id:"my_modal_5",className:"modal modal-bottom sm:modal-middle",children:(0,a.jsxs)("form",{method:"dialog",className:"modal-box",children:[(0,a.jsxs)("aside",{className:"flex  w-full flex-col items-center   text-black",children:[(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)(f,{addConversation:n})}),(0,a.jsx)("div",{className:"divider"}),t&&t.map(e=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{onSelect:s,id:String(e.id)},String(e.id)+"modal"),(0,a.jsx)("div",{className:"divider"})," "]}))]}),(0,a.jsx)("div",{className:"modal-action",children:(0,a.jsx)("button",{className:"btn",children:"Close"})})]})})})}function h(){return(0,a.jsxs)("section",{className:'w-full  grow flex-1 p-8 flex flex-col  justify-end text-neutral-900 bg-[url("https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg")]',children:[(0,a.jsx)("div",{className:"text-center  my-64",children:(0,a.jsx)("h1",{children:" No conversation selected! "})}),(0,a.jsx)("div",{className:"divider"}),(0,a.jsxs)("div",{className:"flex flex-col gap-y-4 items-center sm:flex-row justify-center  gap-x-8 p-8 bg-slate-300  border-",children:[(0,a.jsx)("input",{type:"text",disabled:!0,placeholder:"Type here",className:"input input-bordered input-sm w-full max-w-md"}),(0,a.jsx)("button",{disabled:!0,className:"btn btn-disabled btn-xs sm:btn-md btn-primary",children:"Send message"})]})]})}let v=()=>{let e=fetch("".concat("http://localhost:3002","/api/chat/getConversations"),{method:"GET",credentials:"include"}).then(e=>e.json()).catch(e=>{throw Error("Fail at getting conversations")});return e};function g(){let[e,t]=(0,n.useState)(),[s,l]=(0,n.useState)(""),[c,i]=(0,n.useState)(!0);(0,n.useEffect)(()=>(r.on("connect",()=>{console.log("Socket connected:",r.id)}),()=>{r.disconnect()}),[]),(0,n.useEffect)(()=>{let s=s=>{if(e&&s){let a=[...e,s];t(a),l(String(s.id))}};return r.on("new-conversation",s),()=>{r.off("new-conversation",s)}},[e]),(0,n.useEffect)(()=>{v().then(e=>{t(e.conversations)}).catch(e=>o.Am.error("Error at fetching conversations"))},[]);let u=e=>{l(e)},f=()=>{i(window.innerWidth>1024)},g=s=>{if(e&&s){let a=[...e,s];t(a),l(String(s.id))}};return(0,n.useEffect)(()=>{if(window)return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),(0,a.jsxs)("main",{className:"flex-1 flex max-w-full flex-row  gap-y-8 text-cyan-500",children:[c?(0,a.jsx)(m,{onSelect:u,addConversation:g,Conversations:e||[]}):(0,a.jsx)(x,{addConversation:g,onSelect:u,Conversations:e||[]}),s?(0,a.jsx)(d,{id:s},s):(0,a.jsx)(h,{})]})}}},function(e){e.O(0,[526,253,769,744],function(){return e(e.s=6216)}),_N_E=e.O()}]);