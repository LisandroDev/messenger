(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[951],{6216:function(e,t,s){Promise.resolve().then(s.bind(s,2772))},2772:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return g}});var n=s(9268),a=s(6006),c=function(e){let{message:t,date:s}=e;return(0,n.jsx)("div",{className:"chat chat-end",children:(0,n.jsxs)("div",{className:"chat-bubble bg-[#aad8a1] text-black",children:[t,(0,n.jsx)("div",{className:"chat-footer opacity-50  text-black text-xs",children:"".concat(s.substring(0,10)," ").concat(s.substring(11,16))})]})})},i=function(e){let{message:t,date:s}=e;return(0,n.jsx)("div",{className:"chat chat-start",children:(0,n.jsxs)("div",{className:"chat-bubble  bg-gray-100 text-black",children:[t," ",(0,n.jsx)("div",{className:"chat-footer opacity-50 text-black text-xs",children:"".concat(s.substring(0,10)," ").concat(s.substring(11,16))})]})})},r=s(6323);let l=(0,r.io)("https://messengerapp-27vj.onrender.com",{withCredentials:!0});var o=s(474);function d(e){let{id:t}=e,[s,r]=(0,a.useState)([]),[d,m]=(0,a.useState)(""),[u,f]=(0,a.useState)(""),x=(0,a.useRef)(null),h=()=>{var e;null===(e=x.current)||void 0===e||e.scrollIntoView({behavior:"instant"})};(0,a.useEffect)(()=>{h()},[s]),(0,a.useEffect)(()=>{let e=async()=>{let e=await fetch("".concat("https://messengerapp-27vj.onrender.com","/api/chat/getMessages/").concat(t),{credentials:"include",method:"GET",cache:"default"}),s=await e.json();r(s.messages)};e().catch(e=>o.Am.error("Fail at fetch messages"))},[t]),(0,a.useEffect)(()=>{l.on(t,e=>{r(t=>[...t,{...e,sender:!1}])})},[t]);let v=async e=>{try{m(e);let s=await fetch("".concat("https://messengerapp-27vj.onrender.com","/api/chat/createMessage"),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:t,messageBody:e})}),n=await s.json();g(n)}catch(e){o.Am.error("Fail at send message")}},g=e=>{r(t=>[...t,{...e,sender:!0}])};return(0,n.jsxs)("section",{className:'w-full grow  flex-1 p-8 flex flex-col bg-[url("https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg")] justify-end text-neutral-900 ',children:[(0,n.jsxs)("div",{className:"max-h-[40rem] overflow-auto overflow-x-hidden mb-8  w-full",children:[s&&s.map(e=>e.sender?(0,n.jsx)(c,{message:e.body,date:e.createdAt},e.id):(0,n.jsx)(i,{message:e.body,date:e.createdAt},e.id)),(0,n.jsx)("div",{ref:x})]}),(0,n.jsx)("div",{className:"divider"}),(0,n.jsxs)("div",{className:"flex flex-col gap-y-4 items-center sm:flex-row justify-center  gap-x-8 p-8 bg-slate-300  border-",children:[(0,n.jsx)("input",{onChange:e=>{f(e.currentTarget.value)},value:u,type:"text",placeholder:"Type here",className:"input input-bordered input-sm w-full max-w-md"}),(0,n.jsx)("button",{onClick:()=>{v(u),f("")},className:"btn btn-xs sm:btn-md btn-primary",children:"Send message"})]})]})}function m(e){var t;let{id:s,onSelect:c}=e,[i,r]=(0,a.useState)(),[d,m]=(0,a.useState)(""),[u,f]=(0,a.useState)(!1),[x,h]=(0,a.useState)(0);return(0,a.useEffect)(()=>{let e=async()=>{let e=await fetch("".concat("https://messengerapp-27vj.onrender.com","/api/chat/getInfoOfConversation/").concat(s),{credentials:"include",method:"GET",cache:"default"}),t=await e.json();r(t)};e().catch(e=>{o.Am.error("Error at fetching conversation information")})},[s]),(0,a.useEffect)(()=>{let e=e=>{(null==i?void 0:i.friendId)===e.senderId&&localStorage.getItem("conversationOpen")!==s&&(f(!0),h(e=>e+1)),m(e.body)},t=e=>{if(i){let t={...i,online:e};r(t)}};return l.on("".concat(s,"-badge"),e),l.on(String(null==i?void 0:i.friendId),t),()=>{l.off("".concat(s,"-badge"),e),l.off(String(null==i?void 0:i.friendId),t)}},[s,i]),(0,n.jsx)("div",{className:"w-full rounded-lg",children:(0,n.jsxs)("button",{onClick:()=>{c(s),f(!1),h(0),localStorage.removeItem("conversationOpen"),localStorage.setItem("conversationOpen",s)},className:"flex w-full px-3 justify-evenly items-center  h-12 ",children:[(0,n.jsx)("div",{children:(null==i?void 0:i.avatarUrl)||(0,n.jsx)("div",{className:(null==i?void 0:i.online)?"avatar online":"avatar offline",children:(0,n.jsx)("div",{className:"h-8 rounded-full ring  ring-offset-base-100 ".concat((null==i?void 0:i.online)?"ring-success":"","  ring-offset-2"),children:(0,n.jsx)("img",{src:"https://static-00.iconduck.com/assets.00/avatar-default-symbolic-icon-2048x1949-pq9uiebg.png",alt:"default avatar"})})})}),(0,n.jsxs)("div",{className:"max-w-sm text-center flex flex-col  ",children:[(0,n.jsxs)("span",{className:"text-sm font-bold",children:[" ",i&&i.name]}),(0,n.jsx)("span",{className:"text-xs truncate  w-20",children:d||i&&(null==i?void 0:null===(t=i.lastMessage)||void 0===t?void 0:t.body)})]}),(0,n.jsx)("div",{children:u&&(0,n.jsxs)("div",{className:"badge badge-success badge-xs p-2",children:["+",x]})})]})})}var u=function(e){let{addConversation:t}=e,[s,c]=(0,a.useState)(""),i=async e=>{try{let s=await fetch("".concat("https://messengerapp-27vj.onrender.com","/api/chat/createConversation"),{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({toEmail:e,messageBody:""})});s.ok||o.Am.error("Error at create conversation");let n=await s.json();t(n)}catch(e){o.Am.error("Error at create conversation")}};return(0,n.jsxs)("div",{className:"flex  flex-col  w-fit mt-8 gap-5",children:[(0,n.jsx)("input",{onChange:e=>{c(e.currentTarget.value)},className:"w-full  ring  ring-offset-base-100 ring-offset-2 rounded-md p-2",placeholder:"Type friend email"}),(0,n.jsx)("button",{className:"btn btn-sm btn-info",onClick:e=>{e.preventDefault(),i(s)},children:"Create"})]})};function f(e){let{Conversations:t,onSelect:s,addConversation:c}=e;return(0,n.jsxs)("aside",{className:"hidden lg:flex lg:flex-col items-center   w-1/6  text-black",children:[(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)(u,{addConversation:c})}),(0,n.jsx)("div",{className:"divider"}),t&&t.map(e=>(0,n.jsxs)(a.Fragment,{children:[(0,n.jsx)(m,{onSelect:s,id:String(e.id)}),(0,n.jsx)("div",{className:"divider"})," "]},String(e.id)))]})}function x(e){let{Conversations:t,onSelect:s,addConversation:a}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("dialog",{id:"my_modal_5",className:"modal modal-bottom sm:modal-middle",children:(0,n.jsxs)("form",{method:"dialog",className:"modal-box",children:[(0,n.jsxs)("aside",{className:"flex  w-full flex-col items-center   text-black",children:[(0,n.jsx)("div",{className:"p-4",children:(0,n.jsx)(u,{addConversation:a})}),(0,n.jsx)("div",{className:"divider"}),t&&t.map(e=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(m,{onSelect:s,id:String(e.id)},String(e.id)+"modal"),(0,n.jsx)("div",{className:"divider"})," "]}))]}),(0,n.jsx)("div",{className:"modal-action",children:(0,n.jsx)("button",{className:"btn",children:"Close"})})]})})})}function h(){return(0,n.jsxs)("section",{className:'w-full  grow flex-1 p-8 flex flex-col  justify-end text-neutral-900 bg-[url("https://i.pinimg.com/736x/8c/98/99/8c98994518b575bfd8c949e91d20548b.jpg")]',children:[(0,n.jsx)("div",{className:"text-center  my-64",children:(0,n.jsx)("h1",{children:" No conversation selected! "})}),(0,n.jsx)("div",{className:"divider"}),(0,n.jsxs)("div",{className:"flex flex-col gap-y-4 items-center sm:flex-row justify-center  gap-x-8 p-8 bg-slate-300  border-",children:[(0,n.jsx)("input",{type:"text",disabled:!0,placeholder:"Type here",className:"input input-bordered input-sm w-full max-w-md"}),(0,n.jsx)("button",{disabled:!0,className:"btn btn-disabled btn-xs sm:btn-md btn-primary",children:"Send message"})]})]})}let v=()=>{let e=fetch("".concat("https://messengerapp-27vj.onrender.com","/api/chat/getConversations"),{method:"GET",credentials:"include"}).then(e=>e.json()).catch(e=>{throw Error("Fail at getting conversations")});return e};function g(){let[e,t]=(0,a.useState)(),[s,c]=(0,a.useState)(""),[i,r]=(0,a.useState)(!0);(0,a.useEffect)(()=>(l.on("connect",()=>{console.log("Socket connected:",l.id)}),()=>{l.disconnect()}),[]),(0,a.useEffect)(()=>{let s=s=>{if(e&&s){let n=[...e,s];t(n),c(String(s.id))}};return l.on("new-conversation",s),()=>{l.off("new-conversation",s)}},[e]),(0,a.useEffect)(()=>{v().then(e=>{t(e.conversations)}).catch(e=>o.Am.error("Error at fetching conversations"))},[]);let m=e=>{c(e)},u=()=>{r(window.innerWidth>1024)},g=s=>{if(e&&s){let n=[...e,s];t(n),c(String(s.id))}};return(0,a.useEffect)(()=>{if(window)return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),(0,n.jsxs)("main",{className:"flex-1 flex max-w-full flex-row  gap-y-8 text-cyan-500",children:[i?(0,n.jsx)(f,{onSelect:m,addConversation:g,Conversations:e||[]}):(0,n.jsx)(x,{addConversation:g,onSelect:m,Conversations:e||[]}),s?(0,n.jsx)(d,{id:s},s):(0,n.jsx)(h,{})]})}}},function(e){e.O(0,[526,253,769,744],function(){return e(e.s=6216)}),_N_E=e.O()}]);